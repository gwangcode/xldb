import stdwb as wb, files, os

# Help information
HelpInfo='''
find missing IDs from the grapped ID dir to print out the missing ID receiver names
check_missing_id customs-xlsx-tables id-dirs
e.g. check_missing_id "~/Dropbox/Haitao_Outgoing_Goods/03-03-20 ht*.xlsx" ~/Dropbox/graped_IDs/03-03-20/*.jpg
'''
# Variables & Functions
la=len(args)

# Parameter Options
opts, free=wb.parameter_parse(args, nkey=['help'], pkey=[])

if opts:
  for i in opts:
    if i[0]=='help': err(HelpInfo)
  
if free: 
  lf=len(free)
  if lf>=3: CustomsXl, Dirs=free[1:3]
  else: err('Illegal parameters')
else: err('Illegal parameters')

# Main code
XlList=[i for i in files.walk(CustomsXl) if not os.path.isdir(i)]
PicList=[i for i in files.walk(Dirs) if not os.path.isdir(i)]

pics=[]
MissIDNames=[]
for pic in PicList:
  pic=pic.split('/')[-1]
  pic=pic.split('-')[0]
  pic=pic.split('_')[0]
  pic=pic.split('.jpg')[0]
  if pic: pics.append(pic)
cprint('Missing ID names:')
for i in XlList:
  $. close xl;
  $. open =i .as xl;
  
  if 'xl' in `.lw;`:
    ReceiverList=$. fetch .from xl/Sheet1/F2:F .bycol
    ReceiverList=ReceiverList[0]
    for name in ReceiverList:
        name=name.strip()
        if name not in pics: 
          cprint(name)
          MissIDNames.append(name)

return MissIDNames
    